@model FreelancerİşTakip.Models.Proposal

@{
    ViewData["Title"] = "Yeni Teklif";
}

<div class="container-fluid px-lg-5 my-4">
    <div class="card shadow-lg border-0 overflow-hidden rounded-4">
        <div class="row g-0">
            <!-- Form Section (Wider) -->
            <div class="col-lg-8 p-5 bg-white">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h5 class="text-uppercase text-muted letter-spacing-2 small fw-bold">Pipeline</h5>
                        <h2 class="fw-black display-6">Yeni Teklif Oluştur</h2>
                    </div>
                </div>

                <!-- Template Selector -->
                <div class="card mb-4 border-0 bg-warning bg-opacity-10 rounded-3">
                    <div class="card-body d-flex align-items-center">
                        <i class="bi bi-magic text-warning fs-3 me-3"></i>
                        <div class="flex-grow-1">
                            <label class="form-label fw-bold small text-muted text-uppercase mb-1">Hızlı Başlangıç (Şablon)</label>
                            <select id="templateSelector" class="form-select border-0 shadow-none bg-transparent fw-bold text-dark" style="padding-left:0;" onchange="loadTemplate(this)">
                                <option value="">-- Boş Teklif --</option>
                                @foreach(var t in (SelectList)ViewBag.TemplateId)
                                {
                                    <option value="@t.Value">@t.Text</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>

                <form asp-action="Create">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label asp-for="CustomerId" class="form-label fw-bold small text-muted text-uppercase">Müşteri</label>
                            <select asp-for="CustomerId" class ="form-select form-select-lg bg-light border-0" asp-items="ViewBag.CustomerId">
                                <option value="">-- Seçiniz --</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Title" class="form-label fw-bold small text-muted text-uppercase">Proje Başlığı</label>
                            <input asp-for="Title" class="form-control form-control-lg bg-light border-0" placeholder="Örn. Web Redesign" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="p-4 mb-4 border border-dashed rounded-4 bg-light position-relative">
                        <span class="position-absolute top-0 start-0 translate-middle badge rounded-pill bg-dark text-warning ms-4 mt-1">FİYATLANDIRMA</span>
                        <div class="row pt-3">
                            <div class="col-md-3 mb-3">
                                <label asp-for="HourlyRate" class="form-label small text-muted">Saatlik Ücret</label>
                                <div class="input-group">
                                    <span class="input-group-text border-0 bg-white">₺</span>
                                    <input asp-for="HourlyRate" id="hourlyRate" class="form-control border-0 bg-white" oninput="calculatePrice()" />
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label asp-for="EstimatedHours" class="form-label small text-muted">Tahmini Süre (Saat)</label>
                                <input asp-for="EstimatedHours" id="estimatedHours" class="form-control border-0 bg-white" oninput="calculatePrice()" />
                            </div>
                            <div class="col-md-3 mb-3">
                                <label asp-for="SuggestedPrice" class="form-label small text-muted">Otomatik Hesap</label>
                                <input asp-for="SuggestedPrice" id="suggestedPrice" class="form-control border-0 bg-white text-muted" readonly />
                            </div>
                             <div class="col-md-3 mb-3">
                                <label asp-for="OfferedPrice" class="form-label fw-bold text-success small text-uppercase">Son Teklif</label>
                                <div class="input-group input-group-lg shadow-sm">
                                    <span class="input-group-text bg-white border-0 text-success fw-bold">₺</span>
                                    <input asp-for="OfferedPrice" class="form-control border-0 fw-bold text-success" />
                                </div>
                                <span asp-validation-for="OfferedPrice" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label asp-for="DeliveryDays" class="form-label fw-bold small text-muted text-uppercase">Teslim Süresi (Gün)</label>
                            <input asp-for="DeliveryDays" class="form-control bg-light border-0" />
                        </div>
                        <div class="col-md-4 mb-3">
                            <label asp-for="RevisionLimit" class="form-label fw-bold small text-muted text-uppercase">Revizyon Hakkı</label>
                            <input asp-for="RevisionLimit" class="form-control bg-light border-0" />
                        </div>
                        <div class="col-md-4 mb-3 d-none">
                            <label asp-for="Currency" class="form-label fw-bold small text-muted text-uppercase">Para Birimi</label>
                            <input asp-for="Currency" type="hidden" value="TRY" />
                        </div>
                    </div>

                    <div class="mb-4">
                        <label asp-for="ScopeText" class="form-label fw-bold small text-muted text-uppercase">Kapsam & Detaylar</label>
                        <textarea asp-for="ScopeText" class="form-control bg-light border-0" rows="5" placeholder="Proje kapsamını detaylandırın..."></textarea>
                        <span asp-validation-for="ScopeText" class="text-danger"></span>
                    </div>

                    <div class="d-flex justify-content-end align-items-center gap-3 pt-3 border-top">
                        <a asp-action="Index" class="btn btn-link text-decoration-none text-muted">Vazgeç</a>
                        <button type="submit" class="btn btn-dark btn-lg px-5 rounded-pill shadow icon-link">
                            Teklifi Oluştur
                            <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Visual Section (Sidebar) -->
            <div class="col-lg-4 d-none d-lg-block">
                <div class="h-100 position-relative">
                    <div class="position-absolute top-0 start-0 w-100 h-100 bg-dark" style="background-image: url('https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; opacity: 0.8;"></div>
                    <div class="position-absolute top-0 start-0 w-100 h-100 bg-warning" style="mix-blend-mode: multiply; opacity: 0.3;"></div>
                    
                    <div class="position-relative z-1 h-100 d-flex flex-column justify-content-center p-5 text-white">
                        <i class="bi bi-pen display-3 mb-4 text-warning"></i>
                        <h2 class="display-5 fw-bold mb-3">Win the Deal.</h2>
                        <p class="lead opacity-75">Hazırladığınız her teklif, yeni bir başarı hikayesinin başlangıcıdır. Profesyonel, net ve ikna edici olun.</p>
                        
                        <div class="mt-5 pt-5 border-top border-white border-opacity-25">
                            <p class="small text-uppercase letter-spacing-2 mb-1 opacity-50">Pro Tip</p>
                            <p class="fst-italic opacity-75">"Şablonları kullanarak teklif oluşturma sürenizi %50 azaltabilirsiniz."</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .letter-spacing-2 { letter-spacing: 2px; }
    .fw-black { font-weight: 900; }
    .form-control:focus, .form-select:focus {
        box-shadow: none;
        background-color: #fff !important;
        border: 1px solid #ffc107 !important;
    }
</style>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        function calculatePrice() {
            var rate = parseFloat(document.getElementById('hourlyRate').value) || 0;
            var hours = parseFloat(document.getElementById('estimatedHours').value) || 0;
            var total = rate * hours;
            document.getElementById('suggestedPrice').value = total.toFixed(2);
        }

        function loadTemplate(selectObject) {
            var value = selectObject.value;
            if (value) {
                var url = new URL(window.location.href);
                url.searchParams.set('templateId', value);
                window.location.href = url.toString();
            }
        }
    </script>
}

